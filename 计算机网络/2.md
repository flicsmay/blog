*****###1.接入互联网
***
一开始当一台计算机接入一个新的子网时，这台主机是没有被分配IP地址的。它所拥有的只有一个MAC地址（物理网卡地址）,这个时候它就要向这个子网申请一个IP地址了。这个时候主机就要向DHCP发送一个 **DHCP发现报文** ，这个报文是用于 **向位于局域网中的DHCP服务器申请一段时间的IP使用权** 。

这个报文是通过一个局域网内的 **链路层广播** 实现的，广播就是在 **链路层** 层面上发送一个MAC地址全为FF的报文（路由器会将其丢弃），（链路层是用MAC地址进行寻址）广播报文会被在局域网中的全部主机捕获，这就使DHCP服务器接收到发现报文。

之后DHCP服务器会返回给请求的主机一个DHCP提供报文（其中有几次都是广播交流，不详细写了）， **其中包括了一个合适的IP地址、租期、网关、DNS服务器等** （书上没有详细写，不确定）。

这里稍微提一下DNS服务器、默认网关、子网掩码、IP地址和MAC地址（虽然我知道所有人都知道，但还是写出来吧）。

* IP地址 ：　用于在网络层寻址的标志，一般在某一时刻一个IP地址对应一台主机（很可能不是同一台）
* MAC地址 ： 用于在链路层的寻址，被写入进网卡中，正常情况下是所有主机都不同（但其实是可以通过软件“修改”的）
* DNS服务器 ： 当你要上一个网站（比如www.google.com时 ~~这个好像不行~~ ），你的电脑是不知道你输入的这个网址的IP地址的，这时候就要向DNS服务器发送一个DNS请求，然后DNS服务器就会告诉你相对应的IP地址了
* 子网掩码 ： 就是用来划分IP地址和你所在的主机是否是在同一局域网
* 默认网关 ： 当你要向一个IP发送报文时，网络驱动先会检查这个IP是否和本机在同一局域网。如果在的话就直接向该主机（其实要先获取）发送数据包，若是不在同一局域网，这个数据包会被发送向默认网关（常常是你的局域网的路由器），让默认网关代替你将数据报传输出去。

###2.ARP（地址解析协议）
***
你脸上网络之后就想打开浏览器浏览网页，比如说你输入了 `www.example.com` 。这个url中并没有携带这个网站服务器的IP（靠自己主机储存DNS是不太现实的），所以主机就找到自己网络设置中DNS服务器的IP地址， **向DNS服务器发送一个DNS请求** 。

当你拿到一个IP地址的时候，你就要想着怎么把这个数据包传输到哪里去，这个时候有两种选择：

1. 你的主机和目的主机是在同一子网中
2. 其他情况（也就是不是同一子网）

判断是上述哪种情况就要用到 **子网掩码** 了，`(mask & IP1) == (mask & IP2)` 则说明IP1和IP2是在同一子网中，这时候就可以 **将数据包直接向网络中发送** （在子网中的目标主机就会接收到数据包）。如果不是在同一子网中，就可以 **将数据包发送向默认网关（子网路由器）让其代为发送** 。由于一般来说DNS服务器都不是在子网中，所以我们通过走默认网关（路由器）的走法。这时候就只要向默认网关发送你想要发送的数据包就好。

这里要先说明一下，在链路层中数据帧的传递是通过 **MAC地址** ，也就是我们通常说的网卡或物理地址，网卡在链路层上接收到一封数据时会 **判断数据包的目标MAC地址是否与自身的MAC地址相同** 。对于不同的MAC地址的数据包就会被丢弃（广播地址除外）。

接着上面说，可是这里就有个问题了，我们知道IP地址是网络层的寻址编号，可是我们发送数据包是通过底下的链路层和物理层实现的。（这样可以减少网卡中地址的配置次数，同时可以减少对cpu发出中断的次数-p300）但是这样的话，我们 **只知道默认网关的IP地址而不知道其网卡(MAC)地址** ，这样我们怎么样才能将数据包发送到默认网关呢？这时候我们就要用到 **地址解析协议（ARP）** 了。

ARP协议是用于将一个 **IP地址转换成MAC地址** ，但是仅限于在同一子网中的IP地址（对于没有这个IP地址不会返回，子网外地址会返回错误）。ARP协议是在每台主机或者路由器中有个 **ARP表** ，其中记录着